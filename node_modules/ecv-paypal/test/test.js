'use strict';

var assert = require('assert'),
    ecv = require('../'),
    express = require('express'),
    request = require('supertest');

var app = express();

app.use(ecv());
app.get('/', function (req, res) {
    res.status(200).send('app url');
});

describe('ecv', function () {

    it('regular url, should return 200', function (next) {
        request(app)
            .get('/')
            .expect('Content-Type', /text/)
            .expect(200)
            .end(next);
    });

    it('/ecv, should return 200', function (next) {
        request(app)
            .get('/ecv')
            .expect('Content-Type', /text/)
            .expect(200)
            .end(next);
    });

    it('/ecv/, should return 200', function (next) {
        request(app)
            .get('/ecv/')
            .expect('Content-Type', /text/)
            .expect(200)
            .end(next);
    });

    it('/blah/blah/ecv, should return 200', function (next) {
        request(app)
            .get('/blah/blah/ecv')
            .expect('Content-Type', /text/)
            .expect(200)
            .end(next);
    });

    it('/blah/blah/ecv/?a=b, should return 200', function (next) {
        request(app)
            .get('/blah/blah/ecv/?a=b')
            .expect('Content-Type', /text/)
            .expect(200)
            .end(next);
    });

    it('/blah//blah//ecv/?a=b, should return 200', function (next) {
        request(app)
            .get('/blah//blah//ecv/?a=b')
            .expect('Content-Type', /text/)
            .expect(200)
            .end(next);
    });

    it('/blah/blah/ecv/asdasd?a=b, should return 404', function (next) {
        request(app)
            .get('/blah/blah/ecv/asdasd?a=b')
            .expect('Content-Type', /text/)
            .expect(404)
            .end(next);
    });

});