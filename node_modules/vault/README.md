# PayPal Vault
This library is a wrapper for what is traditionally known as Protected Packages. It provides a simplified API for accessing protected values based on a known key.


## API

Before using, the vault library must be configured using the full file path to the protected file (usually in a directory named 'protected' in the application root, as well as the name of the configuration file.

```javascript
var path = require('path'),
    vault = require('vault');

var options = {
    name:       'fooserv',
    dir:        path.join(process.cwd(), 'protected'),
    passphrase: undefined, // optional
    pinName:    undefined, // optional (will look for pattern {NAME}_PIN, so FOOSERV_PIN, for example)
    pin:        undefined  // optional
};

vault.create(options, function (err, pkg) {
    // package is ready to go
    var username = pkg.get('username');
});
```


Once the library is initialized, values can be retrieved as strings or buffers.
```javascript
var vault = require('vault');
var secret = vault.getString('mykey'); // String
var anotherSecret = vault.getBytes('mykey'); // Buffer
var notSoSecret = vault.get('b64_mykey'); // Buffer
```

***HEADS UP!*** The value returned for a key may be Base64 encoded. If this is the case you can do something like:
```javascript
var vault = require('vault');
var base64EncodedSecret = vault.getString('mykey'); // String
var decodedSecret = new Buffer(base64EncodedSecret, 'base64').toString('utf8');
```

Additionally, some protected data has been processed into a format that may be helpful for TLS/SSL scenarios.
```javascript
var https = require('https');

// Create an SSL Server
var options = vault.getServerCredentials();
var server = https.createServer(options);


// Create an SSL client
var client = vault.getClientCredentials();
options = {
    method: 'GET',
    path: '/',
    passphrase: client.passphrase,
    key: client.key,
    cert: client.cert,
    ca: client.ca
}

var req = https.request(options, function (res) {
    // ...
});
req.end();
```


## API
```javascript
vault.create(options, callback);

vault.get(key);

vault.getString(key);

vault.getBytes(key);

vault.getEncryptedAll();

vault.containsKey(key);

vault.getClientCredentials();

vault.getServerCredentials();
```


## Testing
To run the tests, ensure the mocha and should devDependencies are installed and run `make test`. Note that the passphrase for the test package is 'aardvark'.


