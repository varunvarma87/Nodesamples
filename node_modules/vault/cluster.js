'use strict';
var vault = require('./'),
    path = require('path'),
    repl = require('repl'),
    cluster = require('cluster');




var options = {
    name:       'xoproxy',
    dir:        path.join(process.cwd(), 'test', 'resources', 'xoproxy'),
    passphrase: undefined,
    pinName:    'XOPROXY_PIN',
    pin:        undefined
};


vault.init(options, function (err) {
    if (cluster.isMaster) {
        repl.start('>').context.v = vault;
    } else {
        setInterval(function () {
            console.log(vault.getBytes('encrypted_cert_password'));
        }, 10000);
    }

    if (cluster.isMaster) {
        cluster.fork();
        cluster.fork();
        cluster.fork();
        cluster.fork();
        cluster.fork();
    }
});
