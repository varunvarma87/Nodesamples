# API User Guide
To create an instance of Frontier client use the following constructor.

````
var client = new FrontierClient ("localhost:6001", clientGroup, options)
````

For a list of supported options and their default values see {@link FrontierClient.DefaultOptions}


This object emits 2 events of interest to the user:

* ``FrontierClient.ERROR``

````
client.on (FrontierClient.ERROR, function (error) {
	console.error ("FrontierClient error: %j", error);
});
````
**Note** that this event is provided for information purposes only. There is no need to react to this event by closing the client connection and reopening it as the FrontierClient
does this automatically for as long as {@link FrontierClient#options}``.connect_retry`` is set to ``true`` which is the default. 


and

* ``FrontierClient.CONNECT``
 
````
client.on (FrontierClient.CONNECT, function (error, connectedTo) {
	if (error) {
		console.error ("Frontier client connection error: %j", error)
	} else {
		console.error ("Frontier client is connected to: %s", connectedTo)
	}
}
````

The client exposes 3 methods to interact with Frontier server:

* ``register``

Construct a set of metric descriptors and registered them on the server. The server responds with an array of binary metric IDs that need to be held on and submitted back with every
future sample of this metric. 

````
var metric_set = {
     resolution: 'R_10s',
     domain: 'pp_here_app',
     dimension:[
         {name: 'pool', value:'p123'}, {name:'host', value:'host456'}
     ],
     metric:[
         {name: 'business.metric1', metric_kind:'GAUGE', value_kind:"FLOAT", units:"payments/sec"},
         {name: 'business.metric2', metric_kind:'COUNTER', value_kind:"INT", units:"payments"}
     ]
 };

client.register (metric_set, function (error, response) {
	if (!error) {
		console.log ("Received array of metric IDs: %j", response.metric_id);
	}
});
````
Hold on to ``response.metric_id`` which contains an array of binary metric IDs corresponding to the order of metrics in metric_set. 

For a complete reference on ``metric_set``structure see 
[Frontier protobuf definition](../resources/Protocol.proto#L37)

* ``post``

Use this method to post samples on the previously registered metrics. Note that the size of the array of metric ids and the size of the array of samples must match.
Sample at position i corresponds to metric id at position i in the metric id array.


````
client.post (
    Date.now()/1000, //timestamp, in seconds
    response.metric_id, // array of binary metric IDs returned by 'register' call
    [{float_value: 10 + this_post}, {int32_value: 20 + this_post}], //samples
    postReliability, // post reliability level
    function (err, result, latency) { // callback
        if (err) {
            console.trace(err);
        } else {
            console.log ("received ack for post # %d (latency=%d msec)", this_post, latency);
        }
    }
);
````

The result from post contains the number of samples accepted by the server (result.posted).

An important parameter of the post is the post reliability level. For a list of reliability levels and their meaning see
{@link FrontierClient.PostReliability}

* ``postUnregistered``

This is a shortcut which combines ``register`` and ``post`` into a single method. It's convenient to use it when an application life span is short and the metrics being published 
are unknown ahead of time.  However, for majority of the applications that are publishing metrics to Sherlock the metrics are well known in advance, and in that case it's highly recommended
to use ``register``/``post`` instead of ``postUnregistered``. The main advantage of this technique is efficiency as much fewer number of bytes is being sent out by the client.

````
client.postUnregistered (
    Date.now(),
    {
        resolution: 'R_1m',
        domain: 'pp_here_app',
        dimension:[
            {name: 'pool', value:'p123'}, {name:'host', value:'host456'}
        ],
        metric:[
            {name: 'business.metric3', metric_kind:'GAUGE', value_kind:"DOUBLE", units:"requests/sec"},
            {name: 'business.metric4', metric_kind:'COUNTER', value_kind:"INT", units:"transactions"}
        ]
    },
    [ {float_value: 100}, {int32_value: 200}],
    postReliability,
    function (error, result, latency) {
	}
);

````
