'use strict';

var confit = require('confit_mod'),
    utils = require('../lib/utils');

var confitOption = {},
    appConfigRoot = process.argv[2],
    moduleConfigRoot = process.argv[3];

if (appConfigRoot && moduleConfigRoot) {
    confitOption.basedir = appConfigRoot;
} else {
    confitOption.basedir = moduleConfigRoot;
}

var confiter = confit(confitOption);

if (moduleConfigRoot && appConfigRoot && (appConfigRoot !== moduleConfigRoot)) {
    utils.defaultConfig(confiter, moduleConfigRoot);
}

confiter.create(function (err, config) {
    config = config && config._store || {};
    config = JSON.stringify(config);
    process.stdout.write(utils.CONFIG_TOKEN + config);
    process.exit(0);
});