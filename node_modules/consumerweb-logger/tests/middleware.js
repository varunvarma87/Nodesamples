'use strict';

var assert = require('assert'),
	logger = require('../lib/logger'),
	factory = require('../lib/middleware');

describe('Middleware tests', function () {

	it('should be a factory function', function () {
		var middleware = factory();
		assert.ok(typeof middleware === 'function');
	});

	it('should log to CAL, send a 500 status code, and render the error500 template when invoked', function (done) {
		logger.log = function(err) {
			assert.ok(err.message, 'hey');
			done();
		};
		var middleware = factory('error500');
		var res = {
			status: function(statusCode) {
				assert.equal(statusCode, 500);
			},
			render: function(templateName) {
				assert.equal(templateName, 'error500');
			}
		};
		middleware(new Error('hey'), {}, res);
	});

});