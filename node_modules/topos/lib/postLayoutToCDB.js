#!/usr/bin/env node

'use strict';

var fs = require('fs'),
    properties = require('properties'),
    biblio = require('./bibliography'),
    objutil = require('./util/objutil');


var propConfig = {
    comments: "#",
    separators: "=",
    sections: true
};


exports = module.exports = function PostLayoutToCDB() {
    var data;

    try {

        //read the application.txt
        data = fs.readFileSync(biblio.file.apptext, 'utf8');

        //convert to tokens
        data = properties.parse(data, propConfig);

        //to json
        data = objutil.unpack(data);

    } catch (err) {
        console.log(err);
        return;
    }

    //write TOPO aware final layout.json file
    fs.writeFileSync(biblio.file.layout, JSON.stringify(data, null, 4));
    console.log('writing ' + biblio.file.layout);
};
