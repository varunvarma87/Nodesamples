'use strict';

var assert = require('chai').assert,
    encryptedcookies = require('../lib'),
    express = require('express'),
    request = require('supertest');

describe('write encrypted cookie', function () {

    var app = express();

    it('should write encrypted cookie', function (next) {
        app.use(encryptedcookies({
            encryptionKey: '1h1P/y6F/kg6OlM7oeTms2Yr6Lw=',
            macKey: 'SF4HNI/A1U3xPww2eylPqJNQIvU='
        }));

        app.get('/', function (req, res) {
            res.encryptedCookie('test', 'hello world', function () {
                res.send(200);
            });
        });

        request(app).get('/').end(function (err, res) {
            assert.ok(res.headers['set-cookie']);
            assert.ok(res.headers['set-cookie'].length);
            assert.strictEqual(res.headers['set-cookie'][0], 'test=cXkGacijB-76MThwdk6ibPP3TP3p8HrG5pMInyW8wcLEsWmIBdNiPdTOJo8; Domain=.paypal.com; Path=/; HttpOnly; Secure');
            next();
        });
    });

});