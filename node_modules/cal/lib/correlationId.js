'use strict';

var uuid = require('node-uuid');

module.exports = function getCorrelationId(req) {
    var correlationId = req.headers && req.headers['x-pp-corrid'] || req.correlationId;

    if (!correlationId) {
        var uidRandom = uuid.v4(),
            uidRandomArr = uidRandom.split('-'),
            uidTime = uuid.v1().split('-');

        correlationId = uidTime[0] + uidRandomArr[0].substr(0, 5);
        req.headers = req.headers || {};
        req.headers['x-pp-corrid'] = correlationId;
    }
    req.correlationId = correlationId;

    return correlationId;
};
