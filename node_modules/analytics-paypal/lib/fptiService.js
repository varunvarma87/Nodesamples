'use strict';

var tryRequire = require('try-require'),
    cal = tryRequire('cal');

module.exports = function (config, transport) {

    return {
        /**
         * serverTracking
         * @param fptiServerData
         * @param callback
         */
        serverTracking: function (fptiServerData, callback) {
            var calEvent;
            var payload = JSON.stringify(fptiServerData);
            if (cal) {
                calEvent = cal.createEvent('FPTI', 'serverside_payload');
                calEvent.addData(payload);
                calEvent.complete();
            }
            transport({
                body: payload
            }, callback);
        }
    };
};
