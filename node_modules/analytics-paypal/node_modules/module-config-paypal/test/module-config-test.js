'use strict';

var assert = require('assert'),
    should = require('should'),
    utils = require('./fixtures/utils'),
    modConfig = require('../');

describe('config test using APP1 fixture', function () {
    var fixtures = utils.APP1;

    describe('async', function () {

        beforeEach(function () {
            process.env.NODE_ENV = '';
            modConfig.cache.clear();
        });

        it('No config', function (done) {
            modConfig(module, function (error, config) {
                if (error) {
                    console.log(error);
                }
                assert(!error);
                assert(!config.get('services:pxpservice'));

                done();
            });
        });

        it('default mode', function (done) {
            modConfig(fixtures, function (error, config) {
                if (error) {
                    console.log(error);
                }
                assert(!error);
                var svcsettings = config.get('services:pxpservice');
                should.equal('pxpsvc.vip', svcsettings.hostname);
                assert(config.get('describe') === 'fixture config');
                done();
            });
        });

        it('test mode', function (done) {
            process.env.NODE_ENV = 'test';
            modConfig(fixtures, function (error, config) {
                assert(!error);
                var svcsettings = config.get('services:pxpservice');
                should.equal('localhost', svcsettings.hostname);
                should.equal(false, config.get('services:servicecore:rejectUnauthorized'));
                done();
            });
        });

        it('qa mode', function (done) {
            process.env.NODE_ENV = 'staging';
            modConfig(fixtures, function (error, config) {
                assert(!error);
                var svcsettings = config.get('services:pxpservice');
                should.equal('phx5qa01c-e591.stratus.phx.qa.paypal.com', svcsettings.hostname);
                should.equal(false, config.get('services:servicecore:rejectUnauthorized'));
                done();
            });
        });

        it('production mode', function (done) {
            process.env.NODE_ENV = 'production';
            modConfig(fixtures, function (error, config) {
                assert(!error);
                var svcsettings = config.get('services:pxpservice');
                should.equal('pxpsvc.vip', svcsettings.hostname);
                should.equal(true, config.get('services:servicecore:rejectUnauthorized'));

                done();
            });
        });
    });

    describe('sync', function () {

        beforeEach(function () {
            process.env.NODE_ENV = '';
            modConfig.cache.clear();
        });

        it('No config', function (done) {
            var config = modConfig(module);
            assert(config);
            assert(!config.get('services:pxpservice'));

            done();
        });

        it('default mode', function (done) {
            var config = modConfig(fixtures);
            assert(config);
            var svcsettings = config.get('services:pxpservice');
            should.equal('pxpsvc.vip', svcsettings.hostname);
            assert(config.get('describe') === 'fixture config');
            done();
        });

        it('test mode', function (done) {
            process.env.NODE_ENV = 'test';
            var config = modConfig(fixtures);
            assert(config);
            var svcsettings = config.get('services:pxpservice');
            should.equal('localhost', svcsettings.hostname);
            should.equal(false, config.get('services:servicecore:rejectUnauthorized'));
            done();
        });

        it('qa mode', function (done) {
            process.env.NODE_ENV = 'staging';
            var config = modConfig(fixtures);
            assert(config);
            var svcsettings = config.get('services:pxpservice');
            should.equal('phx5qa01c-e591.stratus.phx.qa.paypal.com', svcsettings.hostname);
            should.equal(false, config.get('services:servicecore:rejectUnauthorized'));
            done();
        });

        it('production mode', function (done) {
            process.env.NODE_ENV = 'production';
            var config = modConfig(fixtures);
            assert(config);
            var svcsettings = config.get('services:pxpservice');
            should.equal('pxpsvc.vip', svcsettings.hostname);
            should.equal(true, config.get('services:servicecore:rejectUnauthorized'));

            done();
        });

    });

});
describe('config test using APP4 fixture(APP4 has a space in its path)', function () {
    var fixtures = utils.APP4;

    describe('async', function () {

        beforeEach(function () {
            process.env.NODE_ENV = '';
            modConfig.cache.clear();
        });

        it('No config', function (done) {
            modConfig(module, function (error, config) {
                if (error) {
                    console.log(error);
                }
                assert(!error);
                assert(!config.get('services:pxpservice'));

                done();
            });
        });

        it('default mode', function (done) {
            modConfig(fixtures, function (error, config) {
                if (error) {
                    console.log(error);
                }
                assert(!error);
                var svcsettings = config.get('services:pxpservice');
                should.equal('pxpsvc.vip', svcsettings.hostname);
                assert(config.get('describe') === 'fixture config');
                done();
            });
        });

        it('test mode', function (done) {
            process.env.NODE_ENV = 'test';
            modConfig(fixtures, function (error, config) {
                assert(!error);
                var svcsettings = config.get('services:pxpservice');
                should.equal('localhost', svcsettings.hostname);
                should.equal(false, config.get('services:servicecore:rejectUnauthorized'));
                done();
            });
        });

        it('qa mode', function (done) {
            process.env.NODE_ENV = 'staging';
            modConfig(fixtures, function (error, config) {
                assert(!error);
                var svcsettings = config.get('services:pxpservice');
                should.equal('phx5qa01c-e591.stratus.phx.qa.paypal.com', svcsettings.hostname);
                should.equal(false, config.get('services:servicecore:rejectUnauthorized'));
                done();
            });
        });

        it('production mode', function (done) {
            process.env.NODE_ENV = 'production';
            modConfig(fixtures, function (error, config) {
                assert(!error);
                var svcsettings = config.get('services:pxpservice');
                should.equal('pxpsvc.vip', svcsettings.hostname);
                should.equal(true, config.get('services:servicecore:rejectUnauthorized'));

                done();
            });
        });
    });

    describe('sync', function () {

        beforeEach(function () {
            process.env.NODE_ENV = '';
            modConfig.cache.clear();
        });

        it('No config', function (done) {
            var config = modConfig(module);
            assert(config);
            assert(!config.get('services:pxpservice'));

            done();
        });

        it('default mode', function (done) {
            var config = modConfig(fixtures);
            assert(config);
            var svcsettings = config.get('services:pxpservice');
            should.equal('pxpsvc.vip', svcsettings.hostname);
            assert(config.get('describe') === 'fixture config');
            done();
        });

        it('test mode', function (done) {
            process.env.NODE_ENV = 'test';
            var config = modConfig(fixtures);
            assert(config);
            var svcsettings = config.get('services:pxpservice');
            should.equal('localhost', svcsettings.hostname);
            should.equal(false, config.get('services:servicecore:rejectUnauthorized'));
            done();
        });

        it('qa mode', function (done) {
            process.env.NODE_ENV = 'staging';
            var config = modConfig(fixtures);
            assert(config);
            var svcsettings = config.get('services:pxpservice');
            should.equal('phx5qa01c-e591.stratus.phx.qa.paypal.com', svcsettings.hostname);
            should.equal(false, config.get('services:servicecore:rejectUnauthorized'));
            done();
        });

        it('production mode', function (done) {
            process.env.NODE_ENV = 'production';
            var config = modConfig(fixtures);
            assert(config);
            var svcsettings = config.get('services:pxpservice');
            should.equal('pxpsvc.vip', svcsettings.hostname);
            should.equal(true, config.get('services:servicecore:rejectUnauthorized'));

            done();
        });

    });

});