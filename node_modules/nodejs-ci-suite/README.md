nodejs-ci-suite
===============

This project provides, task based build options for nodejs modules (For web applications - Please use the [Deploy suite] (https://github.paypal.com/NodeInfra/nodejs-deploy-suite) ).
The default tasks include

- Linting (using [JsHint](http://jshint.com/))
- Run Unit tests (using [Mocha](http://visionmedia.github.com/mocha/))
- Visualize JavaScript source complexity (using [Plato](https://github.com/jsoverson/plato))
- Code coverage (using [Istanbul](https://github.com/yahoo/istanbul))

nodejs-ci-suite build uses [Grunt](http://gruntjs.com/), a JavaScript task runner to run the tasks.

## Getting Started

### CI Suite Fusion Integration
- Create a Jenkins project in the [fusion](https://fusion.paypal.com/jenkins/) 
- Select the Build option "Execute shell" and the following line.

```bash
  curl -k https://github.paypal.com/NodeInfra/nodejs-ci-suite/raw/v1.0.0/ci-init.sh | sh  
```
- Select the Build option "Invoke Ant" (Yes, "ant" is used to invoke the grunt CLI ).
- Add a Build parameter TARGET_REPO and specify the github url of the NodeJs Application project to be built. (This parameter is used for the Git push of reports generated)
- Specify other Optional Build Parameters (Complete list of Build Environment parameters can be found in Documentation section).


If you want to run the CI suite tasks (linting, unit test, and code coverage) during dvelopment phase, you can install this project as an npm module.
### Use during development phase

Install this plugin with the following command:

```bash
  npm install git://github.paypal.com/NodeCoreTeam/nodejs-ci-suite.git#v1.0.0 --save-dev
```

If you have the [PayPal npm registry] (http://npm.paypal.com) added to your npm config, you can use the following command instead.
```bash
  npm install nodejs-ci-suite --save-dev
```

Create the CI build file by executing the following command

```bash
  node_modules/.bin/cibuild create --dev
```
Following files are created at the root directory of the project.
- gruntfiles.js
- ci-build.json
- build.xml
- build.properties
- .jshintrc
- .jshintignore

In addition to this follwing npm dependencies will be added to the package.json. 
  `grunt`, `grunt-cli`, `grunt-contrib-clean`, `grunt-plato`, `grunt-istanbul`, `git://github.paypal.com/NodeCoreTeam/grunt-ci-suite.git`, `nconf`, `confer`, `xunit-file`

Install these dependencies by running `npm install` at the root directory of the project.

To run the grunt test
```bash
  node_modules/.bin/grunt test
```

## Documentation
### Build Parameters

```bash

  "TARGET_REPO"     -   The GitHub URL of the project to be built. (Used for the Git push of reports generated)
  "GIT_PUSH"        -   Set this to True if the reports generated needs to be pushed back to the GitHub. Default value is false. 
  "REPORTS_BRANCH"  -   The branch name used to push the reports. Default value is "gh-pages".
  "REPORTS_DIR"     -   The directory to store the Reports generated by Plato and Istanbul code coverage tool  ( Default value "gh-pages")
  "JSHINT_SRC"      -   The Source directories (comma separated) of the JS files to be Linted  ( Default value - "Gruntfile.js, ./../Gruntfile.js, controller/**/*.js, lib/**/*.js, *.js")
  "JSHINT_REPORTER"	- 	The Reporter type for JSHint. Default value is "default"- This is the default reoprter function of JsHint. Supports other reporters checkstyle and jslint.
                        Also added a special type checkstyle-file to export the checkstyle reoprt to a file. Helpful for Jeckins Integration.
  "CHECKSTYLE_FILE"	- 	The location of the ckeckstyle.xml file to be created.
  "TEST_FILES"      -   The directories (comma separated) of the Mocha Unit test files to be executed  ( Default value -  "test/**/*.js")
  "MOCHA_REPORTER"  -   The Reporter type for Mocha  ( Default value - "spec")
						            Also sdded a special type xunit-file to export the xunit reoprt to s file. Helpful for Jeckins Integration.
  "XUNIT_FILE"		  -	  The location of the xunit.xml file to be created.
  "REPORTS_PLATO"   -   The directory to store the Reports generated by Plato  ( Default value - "gh-pages/plato")
  "REPORTS_COVERAGE"-   The directory to store the Reports generated by Istanbul code coverage tool  ( Default value - "gh-pages/coverage")
  "COVERAGE_SRC"    -   The Source directories (comma separated) of the JS files to be tested for Code coverage  ( Default value -  "controller/**/*.js, lib/**/*.js")
  "COVERAGE_FILE"   -   The location of the Coverage.Json file it is already available  ( Default value - "gh-pages/coverage/**/*.json")
  "COVERAGE_TYPE"   -   The type of Code Coverage reports to be generated ( Default value -  "lcov")
  "COVERAGE_PRINT_TYPE" - The type of Code Coverage reports to be printed on the Console ( Default value -  "both")
  "COVERAGE_FAIL_ON_ERROR" - Set this to "true" if you want to fail the build if the coverage task fails (Default value - "false")
  "NODE_VERSION"   -   The version of node to be installed during build
 
```
## Examples
[Sample fusion project ](https://fusion.paypal.com/jenkins/view/NodeCoreTeam-CI/job/node-cdb-CI/)


## Change Log

<table>
<tr><td>v1.0.15</td><td>Added parameter to fail the build if coverage task fails</td></tr>
<tr><td>v1.0.14</td><td>Fixed lint error in template gruntfile</td></tr>
<tr><td>v1.0.13</td><td>Updated grunt-plato dependency version</td></tr>
<tr><td>v1.0.10</td><td>Changed reports task to coverage</td></tr>
<tr><td>v1.0.9</td><td>Added feature to specify node version during build</td></tr>
<tr><td>v1.0.8</td><td>Increased mocha timeout to 15000 ms</td></tr>
<tr><td>v1.0.6</td><td>Linting all JS files in root directory by default</td></tr>
<tr><td>v1.0.3</td><td>New grunt option to run istanbul code coverage using cli.</td></tr>
<tr><td>v1.0.2</td><td>Reset the current working directory after Mocha test run</td></tr>
<tr><td>v1.0.1</td><td>Added the module PayPal npm registry</td></tr>
<tr><td>v1.0.0</td><td>Project is developed as an npm module</td></tr>
<tr><td>v0.3.0</td><td>Moved Grunt tasks to npm module grunt-ci-suite</td></tr>
<tr><td>v0.2.0</td><td>Added support for xunit-file Reporter and checkstyle Reporter</td></tr>
<tr><td>v0.1.0</td><td>Initial version</td></tr>
<table>

## License
Copyright (c) 2013 NodeCoreTeam  

