'use strict';

var CipherSpec = require('./cipherSpec');

var crypto = require('crypto'),
    util = require('util'),
    utils = require('../utils');

function DesxCipherSpec (name, key, padding) {
    DesxCipherSpec.super_.call(this, name, DesxCipherSpec._formatSecret(DesxCipherSpec._truncateKey(key)), padding);
}

util.inherits(DesxCipherSpec, CipherSpec);

DesxCipherSpec._formatSecret = function _formatSecret (key) {
    var buffer, desKey, pre, post;

    buffer = new Buffer(key, 'binary').slice(0, 20);
    desKey = buffer.slice(0, 8);
    pre = buffer.slice(8, 16);
    post = buffer.slice(12, 20);

    return Buffer.concat([desKey, pre, post]);
};

DesxCipherSpec._truncateKey = function _truncateKey (key) {
    var buffer, hash;

    buffer = new Buffer(utils.slice(key, 0, 20));
    hash = crypto.createHash('sha1');
    
    return hash.update(buffer).digest('binary');
};

module.exports = DesxCipherSpec;
