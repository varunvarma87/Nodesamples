# Overview

Paypal [Passport.js](http://passportjs.org) strategies for Authorization and Authentication.

This middleware provides token validation and some login capabilities.

# Dependencies

PPAuth relies on the presence of the following modules:

* servicecore ^1.0.0
* passport.js ~0.2.0

# Usage

To configure / use `auth-paypal`:

```javascript
var auth = require('auth-paypal');

//Configure application to talk to auth
app.use(auth(options));
```

This is the same as calling `passport.initialize(options)` and adds the `login`, `logout`, and `authorize` strategies to `passport`.

Example:

```javascript
var auth = require('auth-paypal'),
    passport = require('passport');

//Configure application to talk to auth
passport.use(new auth.login.Strategy());
passport.use(new auth.logout.Strategy());
passport.use(new auth.authorize.Strategy());

app.use(passport.initialize());
```

See [passport.js](http://passportjs.org).

### Protecting Routes

```javascript
app.get('/home', auth.authorize({ failureRedirect: '/login' }), function(req, res) {
   ...
});
```

You could also globally wrap authorization around any route, while excluding those you wish to be exempt:

```javascript
app.use( /^\/(?!login|logout)(.*)$/, auth.authorize());
```

This will wrap authorization middleware around every route except `/login and `/logout`.

For more on routing, please refer to the Express documentation.

See also: [Passport.js Authenticate](http://passportjs.org/guide/authenticate/).

### Custom handling of passport strategies

Currently, `authorize`, `login`, and `logout` have default handlers for success, failure, and error.

You can provide a custom handler as the second (or only) argument, as per passport's handlers, and then invoke it directly.

This feature can be used to create custom middleware.

Example:

```javascript
function authorize(req, res, next) {
    auth.authorize(function (err, actor, info) {
        if (err) {
            return next(err);
        }
        if (!actor) {
            res.writeHead(403);
            res.end();
            return;
        }
        next();
    })(req, res, next);
}

app.get('/home', authorize, function (req, res) {
    res.writeHead(200);
    res.end();
});
```

Similar customization can be made for `login` and `logout`.

### Login

```javascript
app.post('/login',  auth.login({ successRedirect: '/'}));
```

#### SLIM Token aka Passporting

SIM's passporting feature can be enabled and used if the param `session_token` is passed to `login` instead of credentials

#### RISK Support

`RiskLoginDetailsVO` required by RISK during login could be passed to SIM during `login` calls. In addition to authentication claims, send `actorInfoVO` with the serialized VO.
