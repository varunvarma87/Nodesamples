node-pplinkpath
===============

Determine resource link urls based on environment. Normally this is handled within the NodeJs infra so end user involvement is limited.

The logic for determining the URLs is as follows:

- **live mode** - load things from paypalobjects.com
- **sandbox mode** - load from configured URL (see below)
- **stage mode** - use relative paths
In Stage environment also, the resources (css, js and templates) are served within the app itself by default, so it makes sense to use the relative paths. This is the default behaviour.
- **development mode** - use relative paths

**Note:** Modes are *not* determined based on `NODE_ENV`

### Environment Logic

The following logic is used to determine which mode your server should be in:

- You are assumed to be in `live` mode by default.
- If your hostname contains the string `sandbox` it is considered to be in sandbox mode.
- If your hostname contains the string `stage` or the `DEPLOY_ENV` is matches the string `stage` you'll be in stage mode.
- Finaly if your hostname contains the string `localhost` you'll be put in development mode.

### Sandbox configuration

If you want to specify an alternate host domain to use for a *sandbox environment*,
add an override to your config/app.json of the form:
```javascript
"links": {
	"base": {
		"sandbox": "www.paypalobjects.com"
	}
}
````

### Other Ovverrides

If you aren't in sandbox mode you can configure the hostname in either of the following ways:

- Update `/etc/hosts` on your client machine to modify the hostname to trigger the correct (i.e. "localhost.paypal.com" for development mode).
- Set the `HOST_FQDN` environment variable on the server to the appropriate hostname.
- Sometimes you want to override/disable the host detection feature. For example, when you want to hit your local machine from mobile device
  within eBay VPN e.g. http://d-sjn-00547121.corp.ebay.com:8000/businessexp/login and force the development environment. You can achieve that by adding following in your app.js: `"links": { "env": "development" }`

### How to use (internals)

```javascript
    var pplinkpath = require('pplinkpath');       //require declaration
    var host = req.headers.host;
    pplinkpath.linksBuilder(host, res); 	// host is from request, res is response object
    //res.locals.context.links now contains jsBaseUrl, cssBaseUrl, templateBaseUrl and resourceBaseUrl

    //To establish a different hash path for resource paths for pplinkpath, set it via
    // setResourceLinks before calling linksBuilder.

    pplinkpath.setResourceLinks(myHashPath);
```
