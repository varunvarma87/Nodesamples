
<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Node-mayfly : Mayfly client for node.js" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Node-mayfly</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.paypal.com/NodeCoreTeam/node-mayfly">View on GitHub</a>

          <h1 id="project_title">Node-mayfly</h1>
          <h2 id="project_tagline">Mayfly client for node.js</h2>

        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>node-mayfly (based on Mayfly2 Spec)</h1>

<p>Mayfly2 client for node.js</p>

<h3>Configuation</h3>

<p>This is the format of mayfly configuration object.</p>

<div class="highlight"><pre>var <span class="nv">config</span> <span class="o">=</span> <span class="o">{</span>
       appName: <span class="s2">""</span>,    //default <span class="s1">'NodeMayflyClient'</span>
       namespace : <span class="s2">""</span>,  //default <span class="s1">'NodeClient'</span>
       lifetime : 30,    //default  3 days in sec
       server : <span class="o">{</span>
           ip : <span class="s2">"10.x.x.x"</span>,
           port : 10368
       <span class="o">}</span>,
       crypto : <span class="nb">false</span>|true, //Use data encryption
       algorithm : <span class="s1">'aes-256-cbc'</span>    //crypto algorithm
    <span class="o">}</span>
</pre></div>

<p>Let's discuss each of the option in detail.</p>

<ul>
<li>
<strong>appName</strong> - Name of the application.</li>
<li>
<strong>namespace</strong> - This is to identify the client. By default it will be 'NodeClient'. recommended not to overwrite.</li>
<li>
<strong>lifetime</strong> - lifetime of each mayfly record (in sec). After the seconds are over, server will automatically delete the record. Default and max value is 3 days.</li>
<li>
<strong>server</strong> - Mayfly server configuration. It needs ip and port address. Default port number is 10368</li>
<li>
<strong>crypto</strong> - Boolean configuration option to decide if to use data encryption. </li>
<li>
<strong>algorithm</strong> - If crypto is true, it uses this algorithm to encrpyt-decrypt. Since node.js uses openssl, the algorithm has to be supported by openssl. To see the list of available algorithms, execute <code>openssl list-message-digest-algorithms</code> command</li>
</ul><h2>Overview</h2>

<p>One of PayPal's important infrastructure is Mayfly2, an in-memory data store / data cache.</p>

<p>Mayfly is a key-based in-memory database system, with both intra-site and inter-site data backup to guarantee high reliability and availability. Data is stored in a very flexible key-value format. It offers full Create, Read, Update and Delete (CRUD) operation.
Communication with Mayfly2 is via TCP/IP sockets transmitting Mayfly messages using a proprietary binary protocol. The Mayfly protocol is completely stateless and communication is a typical request-response pattern.</p>

<h5>Mayfly Server</h5>

<p>Mayfly server is a stage/hyper/LIVE box that's running mayflydirectoryserv service.</p>

<p>For mayfly server 10.x.x.x, mayfly admin console is available at</p>

<div class="highlight"><pre>http://10.x.x.x:10369/stats.
</pre></div>

<p>To debug and see server logs, follow these steps</p>

<div class="highlight"><pre>ssh 10.x.x.x
tail -f /x/web/STAGE2XXXX/mayflydirectoryserv/logs/mayflydirectoryserv/current
</pre></div>

<h5>Message Format</h5>

<p>message format is discribed here <a href="https://confluence.paypal.com/cnfl/display/ICARUS/Icarus+Mayfly2+Client">Mayfly2 Client</a></p>

<h5>Serialization/Deserialization</h5>

<p><a href="https://github.paypal.com/Infrastructure/infra/blob/master/all/ifeature/service/mayflyng/shared/Msg.cpp">https://github.paypal.com/Infrastructure/infra/blob/master/all/ifeature/service/mayflyng/shared/Msg.cpp</a></p>

<h2>To Play with it</h2>

<ol>
<li>
<p>Run npm install to load the dependencies</p>

<div class="highlight"><pre><span class="nv">$ </span>npm install
</pre></div>
</li>
<li>
<p>To see the sample crud operation using node-mayfly.</p>

<div class="highlight"><pre><span class="nv">$ </span>node app.js
<span class="nv">$ </span>node app.js --perf<span class="o">=</span><span class="nb">true</span> --load<span class="o">=</span>100 --timeout<span class="o">=</span>1000 <span class="c">#optional arguments to run load testing</span>
</pre></div>
</li>
<li>
<p>To run unit tests</p>

<div class="highlight"><pre><span class="nv">$ </span>make <span class="nb">test</span>
</pre></div>
</li>
</ol>

<h3>Code coverage</h3>
  <p><a href="lcov-report/index.html">Code Coverage result</a></p>

      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Node-mayfly maintained by <a href="https://github.paypal.com/NodeCoreTeam">NodeCoreTeam</a></p>
      </footer>
    </div>

    

  </body>
</html>
