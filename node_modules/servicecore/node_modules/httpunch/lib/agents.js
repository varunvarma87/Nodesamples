'use strict';

var Http = require('http');
var Https = require('https');
var Utils = require('./utils');

Http.globalAgent.maxSockets = Infinity;
Https.globalAgent.maxSockets = Infinity;

exports.create = function (options) {
    options = Utils.cleanAgentConfig(options);

    if (!options.maxSockets) {
        options.maxSockets = Http.globalAgent.maxSockets;
    }

    if (options.protocol !== 'https:') {
        return new Http.Agent({
            maxSockets: options.maxSockets,
            maxFreeSockets: options.maxFreeSockets,
            keepAlive: options.keepAlive,
            keepAliveMsecs: options.keepAliveMsecs
        });
    }

    options.ciphers = options.ciphers || Https.globalAgent.options.ciphers;

    return new Https.Agent(options);
};
