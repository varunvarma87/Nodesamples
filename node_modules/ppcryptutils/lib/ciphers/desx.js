'use strict';

var CipherSpec = require('./cipherSpec');

var crypto = require('crypto'),
    util = require('util');

function DesxCipherSpec (name, key, padding) {
    DesxCipherSpec.super_.call(this, name, DesxCipherSpec._formatSecret(DesxCipherSpec._truncateKey(key)), padding);
}

util.inherits(DesxCipherSpec, CipherSpec);

DesxCipherSpec._formatSecret = function _formatSecret (key) {
    var buffer = new Buffer(key, 'binary').slice(0, 20);

    var desKey = buffer.slice(0, 8);
    var pre = buffer.slice(8, 16);
    var post = buffer.slice(12, 20);

    return Buffer.concat([desKey, pre, post]);
};

DesxCipherSpec._truncateKey = function _truncateKey (key) {
    var buffer = key.slice(0, 20);
    var hash = crypto.createHash('sha1');
    return hash.update(buffer).digest('binary');
};

module.exports = DesxCipherSpec;
